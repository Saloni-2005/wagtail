{% load wagtailimages_tags %}

<div class="carousel-block" style="position: relative; max-width: 100%; overflow: hidden; margin-bottom: 30px;">
    <div class="carousel-track" style="display: flex; transition: transform 0.5s ease-in-out;">
        {% for item in self.items %}
        <div class="carousel-slide" style="min-width: 100%; position: relative;">
            {% image item.image original as img %}
            <div class="slide-image-wrapper" style="width: 100%; height: 500px; overflow: hidden;">
                <img src="{{ img.url }}" alt="{{ item.image.title }}"
                    style="width: 100%; height: 100%; object-fit: cover;">
            </div>

            {% if item.title or item.text %}
            <div class="slide-content"
                style="position: absolute; bottom: 50px; left: 50px; background: rgba(0,0,0,0.6); color: white; padding: 20px; border-radius: 4px; max-width: 500px;">
                {% if item.title %}
                <h3 style="margin-top: 0; font-size: 2rem;">{{ item.title }}</h3>
                {% endif %}
                {% if item.text %}
                <p style="margin-bottom: 15px;">{{ item.text }}</p>
                {% endif %}
                {% if item.link_url %}
                <a href="{{ item.link_url }}"
                    style="display: inline-block; background: white; color: black; padding: 10px 20px; text-decoration: none; border-radius: 4px; font-weight: bold;">
                    {{ item.link_text|default:"Learn More" }}
                </a>
                {% endif %}
            </div>
            {% endif %}
        </div>
        {% endfor %}
    </div>

    <!-- Navigation Arrows -->
    <button class="carousel-prev"
        style="position: absolute; top: 50%; left: 20px; transform: translateY(-50%); background: rgba(255,255,255,0.5); border: none; padding: 10px; cursor: pointer; border-radius: 50%; font-size: 20px;">&#10094;</button>
    <button class="carousel-next"
        style="position: absolute; top: 50%; right: 20px; transform: translateY(-50%); background: rgba(255,255,255,0.5); border: none; padding: 10px; cursor: pointer; border-radius: 50%; font-size: 20px;">&#10095;</button>
</div>

<script>
    (function () {
        // Isolate scope
        const carousel = document.currentScript.previousElementSibling;
        const track = carousel.querySelector('.carousel-track');
        const slides = carousel.querySelectorAll('.carousel-slide');
        const nextBtn = carousel.querySelector('.carousel-next');
        const prevBtn = carousel.querySelector('.carousel-prev');

        let currentIndex = 0;

        function updateSlide() {
            track.style.transform = `translateX(-${currentIndex * 100}%)`;
        }

        nextBtn.addEventListener('click', () => {
            currentIndex = (currentIndex + 1) % slides.length;
            updateSlide();
        });

        prevBtn.addEventListener('click', () => {
            currentIndex = (currentIndex - 1 + slides.length) % slides.length;
            updateSlide();
        });

        // Auto Play (Optional)
        setInterval(() => {
            currentIndex = (currentIndex + 1) % slides.length;
            updateSlide();
        }, 5000);
    })();
</script>